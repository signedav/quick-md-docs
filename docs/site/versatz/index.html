<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<link href="../assets/lksob-perimeter-manager-icon.svg" rel="icon"/>
<meta content="mkdocs-1.6.1, mkdocs-material-9.6.5" name="generator"/>
<title>Versatzproblem bei CadastraSymbol Fonts in QGIS - Daves Docs</title>
<link href="../assets/stylesheets/main.8608ea7d.min.css" rel="stylesheet"/>
<link href="../assets/stylesheets/palette.06af60db.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
<script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
</head>
<body data-md-color-accent="indigo" data-md-color-primary="green" data-md-color-scheme="default" dir="ltr">
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#versatzproblem-bei-grenzpunkten-des-cadastrasymbol-fonts-in-qgis">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="Daves Docs" class="md-header__button md-logo" data-md-component="logo" href=".." title="Daves Docs">
<img alt="logo" src="../assets/lksob-perimeter-manager-icon.svg"/>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            Daves Docs
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              Versatzproblem bei CadastraSymbol Fonts in QGIS
            
          </span>
</div>
</div>
</div>
<form class="md-header__option" data-md-component="palette">
<input aria-label="Switch to dark mode" class="md-option" data-md-color-accent="indigo" data-md-color-media="" data-md-color-primary="green" data-md-color-scheme="default" id="__palette_0" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_1" hidden="" title="Switch to dark mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"></path></svg>
</label>
<input aria-label="Switch to light mode" class="md-option" data-md-color-accent="indigo" data-md-color-media="" data-md-color-primary="green" data-md-color-scheme="slate" id="__palette_1" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_0" hidden="" title="Switch to light mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"></path></svg>
</label>
</form>
<script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
<div class="md-header__source">
<a class="md-source" data-md-component="source" href="https://github.com/opengisch/ch.sob.lksob.perimeter-manager" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"></path></svg>
</div>
<div class="md-source__repository">
    opengisch/quick-md-docs
  </div>
</a>
</div>
</nav>
<nav aria-label="Tabs" class="md-tabs" data-md-component="tabs">
<div class="md-grid">
<ul class="md-tabs__list">
<li class="md-tabs__item md-tabs__item--active">
<a class="md-tabs__link" href="./">
        
  
    
  
  Versatzproblem bei CadastraSymbol Fonts in QGIS

      </a>
</li>
</ul>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary md-nav--lifted" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="Daves Docs" class="md-nav__button md-logo" data-md-component="logo" href=".." title="Daves Docs">
<img alt="logo" src="../assets/lksob-perimeter-manager-icon.svg"/>
</a>
    Daves Docs
  </label>
<div class="md-nav__source">
<a class="md-source" data-md-component="source" href="https://github.com/opengisch/ch.sob.lksob.perimeter-manager" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"></path></svg>
</div>
<div class="md-source__repository">
    opengisch/quick-md-docs
  </div>
</a>
</div>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
<span class="md-ellipsis">
    Versatzproblem bei CadastraSymbol Fonts in QGIS
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<a class="md-nav__link md-nav__link--active" href="./">
<span class="md-ellipsis">
    Versatzproblem bei CadastraSymbol Fonts in QGIS
    
  </span>
</a>
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#what-is-the-bug-or-the-crash">
<span class="md-ellipsis">
      What is the bug or the crash?
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#the-current-situation">
<span class="md-ellipsis">
      The current situation
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#other-approaches">
<span class="md-ellipsis">
      Other approaches
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#what-is-the-bug-or-the-crash">
<span class="md-ellipsis">
      What is the bug or the crash?
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#the-current-situation">
<span class="md-ellipsis">
      The current situation
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#other-approaches">
<span class="md-ellipsis">
      Other approaches
    </span>
</a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">

<h1 id="versatzproblem-bei-grenzpunkten-des-cadastrasymbol-fonts-in-qgis">Versatzproblem bei Grenzpunkten des CadastraSymbol Fonts in QGIS</h1>
<h2 id="what-is-the-bug-or-the-crash">What is the bug or the crash?</h2>
<p>It should be possible to use the baseline of a font for symbol placement.</p>
<p>The following image shows the font <a href="https://www.cadastre-manual.admin.ch/de/plan-fur-das-grundbuch">cadastra</a> which has set the baseline to the center of the symbol. The point should be centered over the intersection point of the lines.</p>
<p><img alt="image" src="https://gist.github.com/user-attachments/assets/236b689c-1fc3-4e51-8d68-0d29bd48673f"/></p>
<p>But the symbols of the cadastra font are centered on the baseline.</p>
<p><img alt="image" src="https://gist.github.com/user-attachments/assets/a5272cb6-c266-44df-a4a6-9b41c8ca2a08"/></p>
<p>It can be assumed that with the “Bottom” setting, the symbols should be placed in the correct position.</p>
<p>But it doensn't do that. Neither with the cadastra font:</p>
<p><img alt="image" src="https://gist.github.com/user-attachments/assets/fb32e978-135e-4ac2-8423-9d03f2a3c0a8"/></p>
<p>Nor with any other font (here Deja Vu):</p>
<p><img alt="image" src="https://gist.github.com/user-attachments/assets/c7174885-028a-40bf-b0b7-d1d32c9cae2b"/></p>
<p>The symbols are slighly above the bottom line.</p>
<p><a href="https://github.com/qgis/QGIS/issues/59732">QGIS Issue</a></p>
<h2 id="the-current-situation">The current situation</h2>
<p>The <em>middlepoint</em> is everywhere the "source of truth": it's calculated in the font marker layer as the <em>middle</em> of the <code>baseline</code> and <code>QFontMetrics::ascent()</code>, what is basically the highest possible point of a font (like the top of the "aigu" of the À). This summed up to the point's coordinates defines, where to draw top left of the symbol. With the anchor "center" this would work.</p>
<p>But when we want to have the bottom of the symbol on the coordinate of the point, it sums up again the half of the symbol size. And this would work <em>but</em> here it doesn't calculate the half of the distance between the <code>baseline</code> and the <code>QFontMetrics::ascent()</code> but instead it takes the scaled symbolsize - and <strong>these two measurements differed</strong>. What leaded to the wrong placement:</p>
<p><img alt="image" src="https://gist.github.com/user-attachments/assets/f4fc46ad-ff15-4115-85fa-97d72999ef6c"/></p>
<p>The left is what it is expected to be and the right the one that was the situation. The purple line is one measurement and the cyan one the other. When summing up the half of the first size with the half of the second size then the symbol got misplaced.</p>
<p>With this fix, the two offsets are always calculated the same, which leads to a correct position of the FontMarkers on Bottom.</p>
<p>Means before on bottom (example with Font DejaVu Sans and CadastraSymbol):</p>
<p><img alt="image" src="https://gist.github.com/user-attachments/assets/7f1b1998-a874-42ab-84dd-6c195295bf33"/></p>
<p>Now:</p>
<p><img alt="image" src="https://gist.github.com/user-attachments/assets/0fcc1902-7e01-4c96-8617-952650468cfb"/></p>
<p><a href="https://github.com/qgis/QGIS/pull/60044">QGIS Pull Request</a></p>
<h2 id="other-approaches">Other approaches</h2>
<p>The first idea to fix it came up, by creating an anchor on the <strong>bounds</strong>, like this:</p>
<p><img alt="image" src="https://gist.github.com/user-attachments/assets/20c67cbe-aec8-408a-9d93-47373aa26e79"/></p>
<p>But this does not work in the case of cadastre since the "center" of the symbol is not the center of the bounds.</p>
<p><img alt="image" src="https://gist.github.com/user-attachments/assets/0f4cd257-f494-4e96-97a0-d222b17cf381"/></p>
<p>The cadastre needs the baseline setting. Although the approach with the <strong>bounds</strong> makes sense for other fonts and letters (like the j here on baseline compared to the bounds above):</p>
<p><img alt="image" src="https://gist.github.com/user-attachments/assets/d7ce7abb-934a-4cb2-a052-a2278a58b478"/></p>
<p>We did some research and tests on this approach and finally opened a draft Pull Request and an issue. Another QGIS core developer already mentioned interrests to implement it.</p>
<p><a href="https://github.com/qgis/QGIS/issues/60836">QGIS Issue</a></p>
<p><a href="https://github.com/qgis/QGIS/pull/60080">QGIS Pull Request Work in Progress (closed)</a></p>
</article>
</div>
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
      Material for MkDocs
    </a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "..", "features": ["navigation.tabs", "navigation.tabs.sticky", "search.suggest", "search.highlight"], "search": "../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
<script src="../assets/javascripts/bundle.f1b6f286.min.js"></script>
</body>
</html>